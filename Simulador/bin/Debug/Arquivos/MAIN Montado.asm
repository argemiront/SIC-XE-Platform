MAIN	START	0
	EXTDEF	BUFFER, BUFEND, LENGHT
	EXTREF	RDEN, RDSA
0000	CLOOP	+JSUB	RDEN			4B100000
0004		LDA	LENGHT			03201C
0007		COMP	#0			290000
000A		JEQ	ENDFIL			332007
000D		+JSUB	RDSA			4B100000
0011		J	CLOOP			3F2FEC
0014	ENDFIL	LDA	#0			010000
0017		STA	LENGHT			0F2009
001A		+JSUB	RDSA			4B100000
001E		SVC			B000
0020	RETADR	RESW	1
0023	LENGHT	RESW	1
0026	BUFFER	RESB	10
0030	BUFEND	EQU	*
0031	MAXLEN	EQU	BUFEND-BUFFER
.
.	SUB-ROTINA PARA GUARDAR REGISTRO NO BUFFER
RDEN	CSECT
	EXTREF	BUFFER, LENGHT, BUFEND
0000		CLEAR	X			B410
0002		CLEAR	A			B400
0004		LDS	#48			6D0030
0007		LDT	MAXLEN			77201F
000A	RLOOP	TD	INPUT			E3201B
000D		JEQ	RLOOP			332FFA
0010		RD	INPUT			DB2015
0013		COMPR	A,S			A004
0015		JEQ	EXIT			332009
0018		+STCH	BUFFER,X			57900000
001C		TIXR	T			B850
001E		JLT	RLOOP			3B2FE9
0021	EXIT	+STX	LENGHT			13100000
0025		RSUB			4F0000
0028	INPUT	BYTE	X'F1'		F1
0029	MAXLEN	WORD	BUFEND-BUFFER		000000
.
.	SUB-ROTINA PARA TRANSFERIR REGISTRO DO BUFFER
.
RDSA	CSECT
	EXTREF	LENGHT, BUFFER
0000		CLEAR	X			B410
0002		+LDT	LENGHT			77100000
0006	WLOOP	TD	OUTPUT			E32012
0009		JEQ	WLOOP			332FFA
000C		+LDCH	BUFFER,X			53900000
0010		WD	OUTPUT			DF2008
0013		TIXR	T			B850
0015		JLT	WLOOP			3B2FEE
0018		RSUB			4F0000
001B	OUTPUT	BYTE	X'05'		05
	END	FIRST
